# Trigger a Cloudflare Pages deploy on every push to main.
# Fixes: Cloudflare not auto-pulling from repo — you no longer need to manually trigger.
#
# One-time setup:
# 1. In Cloudflare: Pages project → Settings → Builds & deployments → Deploy hooks → Add hook.
#    Name it e.g. "GitHub Push", copy the hook URL.
# 2. In GitHub: repo → Settings → Secrets and variables → Actions → New repository secret.
#    Name: CLOUDFLARE_DEPLOY_HOOK_URL
#    Value: paste the deploy hook URL from step 1.
# 3. Push this workflow. After that, every push to main will trigger a deploy.

name: Deploy to Cloudflare Pages

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Cloudflare Pages deploy
        env:
          CLOUDFLARE_DEPLOY_HOOK_URL: ${{ secrets.CLOUDFLARE_DEPLOY_HOOK_URL }}
        run: |
          if [ -z "$CLOUDFLARE_DEPLOY_HOOK_URL" ]; then
            echo "CLOUDFLARE_DEPLOY_HOOK_URL secret not set. Add it in GitHub repo Settings → Secrets → Actions."
            exit 1
          fi
          curl -f -X POST "$CLOUDFLARE_DEPLOY_HOOK_URL"
